---
import BaseLayout from "../../../../layouts/BaseLayout.astro";

const title = "EKG Analog Front-End (Instrumentation Amp + Active Bandpass)";
const subtitle =
  "Conditions a noisy, mV-level EKG signal: amplify the differential input, reduce DC offset, and suppress unwanted noise to make the waveform easier to observe / digitize.";

const overview = {
  goal:
    "Take a small, noise-prone EKG signal and produce a clean, usable output level with reduced baseline drift and noise.",
  built:
    "A two-stage analog chain: (1) an instrumentation amplifier for differential gain, then (2) an op-amp active bandpass to reject DC/low-frequency drift and reduce out-of-band noise.",
  tech:
    "Analog circuit design, instrumentation amplifier, active filters (op-amps), frequency response, breadboard implementation + debugging, measurement (scope, etc.).",
};

const decisions = [
  "Amplify first (instrumentation amp) to bring the signal into a workable range, then filter for clean shaping.",
  "Use a reference/bias point to avoid clipping and preserve usable output swing.",
  "Use bandpass behavior to reduce DC/baseline drift while attenuating high-frequency noise and line-related interference.",
];

const validation = [
  "Verified bandpass behavior using known test signals and observing output across frequency changes.",
  "Checked that DC offset introduced at the input is attenuated at the output (high-pass behavior).",
  "Measured an EKG/heartbeat waveform and confirmed the conditioned output is easier to interpret.",
];

const results = [
  "Amplified a mV-level EKG signal and reduced baseline drift + noise.",
  "Captured both test-signal response and a measured heartbeat waveform (images below).",
];

const assets = {
  testSignal: "projects/ekg-front-end/test-signal.jpg",
  heartbeat: "projects/ekg-front-end/heartbeat.jpg",
  onPerson: "projects/ekg-front-end/on-person.jpg",
};
---

<BaseLayout title={`${title} | Cooper Lender`} lang="en">
  <a href="../../" class="muted">← Back</a>

  <h1>{title}</h1>
  <p class="muted">{subtitle}</p>

  <div class="card">
    <h2>Overview</h2>
    <ul>
      <li><strong>Goal:</strong> {overview.goal}</li>
      <li><strong>Built:</strong> {overview.built}</li>
      <li><strong>Tech:</strong> {overview.tech}</li>
    </ul>
  </div>

  <div class="card">
    <h2>Architecture</h2>
    <ul>
      <li>Electrodes (differential input) → instrumentation amplifier (gain + reference/bias)</li>
      <li>Instrumentation amp output → active bandpass (DC rejection + noise reduction)</li>
      <li>Conditioned output → waveform observation / ADC input</li>
    </ul>
  </div>

  <div class="card">
    <h2>Validation</h2>
    <ul>
      {validation.map((v) => <li>{v}</li>)}
    </ul>

    <div class="muted" style="margin-top: 10px;">Test signal response:</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.testSignal}`}
      alt="Test signal response"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />

    <div class="muted" style="margin-top: 14px;">Measured heartbeat waveform:</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.heartbeat}`}
      alt="Measured heartbeat waveform"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />

    <div class="muted" style="margin-top: 14px;">Measurement setup (on-person):</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.onPerson}`}
      alt="On-person measurement setup"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />
  </div>

  <div class="card">
    <h2>Design notes</h2>
    <ul>
      {decisions.map((d) => <li>{d}</li>)}
    </ul>
  </div>

  <div class="card">
    <h2>Results</h2>
    <ul>
      {results.map((r) => <li>{r}</li>)}
    </ul>
  </div>

  <div class="card">
    <h2>Further improvements</h2>
    <ul>
      <li>Increase robustness/safety for real-world use (input protection, isolation, etc.).</li>
      <li>Retune filtering to better suppress line-related noise while preserving sharp EKG features.</li>
      <li>Move to a PCB to reduce wiring noise and improve repeatability.</li>
    </ul>
  </div>
</BaseLayout>
