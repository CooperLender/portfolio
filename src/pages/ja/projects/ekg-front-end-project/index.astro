---
import BaseLayout from "../../../../layouts/BaseLayout.astro";

const title = "EKG（心電図）アナログ・フロントエンド（計装アンプ＋アクティブ・バンドパス）";
const subtitle =
  "mVレベルでノイズの多い心電図信号を、増幅しつつ直流オフセットとノイズを除去して、波形観測・デジタル化しやすい形に整形。";

const overview = {
  goal:
    "微小でノイズが乗りやすいEKG信号を、観測・デジタル化しやすいレベルへ増幅し、直流オフセットや不要帯域ノイズを抑える。",
  built:
    "2段構成のアナログ回路：(1) 計装アンプで差動信号を増幅、(2) オペアンプで構成したアクティブ・バンドパスでDC除去とノイズ低減を実施。",
  role:
    "ゲインとカットオフ周波数の設計、ブレッドボード実装、テスト信号での検証の後、実際の心拍計測（Week 2）まで実施。",
  tech:
    "アナログ回路設計、計装アンプ、アクティブフィルタ（オペアンプ）、周波数特性、ブレッドボード実装・デバッグ、計測。",
};

const decisions = [
  "まず計装アンプで差動信号を安定に増幅し、その後にフィルタ処理を行う構成にした。",
  "クリッピングを避けるため、基準電圧/バイアスを考慮して利用可能な信号振幅を確保した。",
  "バンドパス特性によりDC成分（ベースラインのずれ）を除去し、同時にノイズ（商用電源由来の結合など）を抑える方針にした。",
];

const validation = [
  "既知のテスト信号を入力し、周波数を変化させながら出力を観測してバンドパス挙動を確認した。",
  "入力に大きなDCオフセットを加えても、出力のオフセットが減衰することを確認した（ハイパス動作）。",
  "Week 2：電極を用いて実際の心拍を計測。安全性と安定性のために抵抗を追加した構成で測定した。",
];

const results = [
  "mVレベルのEKG信号を増幅し、直流オフセットとノイズを抑えた波形を得た。",
  "テスト信号での応答と、実測の心拍波形を取得できた（下の画像）。",
];

const assets = {
  testSignal: "projects/ekg-front-end/test-signal.jpg",
  heartbeat: "projects/ekg-front-end/heartbeat.jpg",
  onPerson: "projects/ekg-front-end/on-person.jpg",
};
---

<BaseLayout title={`${title} | Cooper Lender`} lang="ja">
  <a href="../../" class="muted">← 戻る</a>

  <h1>{title}</h1>
  <p class="muted">{subtitle}</p>

  <div class="card">
    <h2>概要</h2>
    <ul>
      <li><strong>目的：</strong> {overview.goal}</li>
      <li><strong>実装内容：</strong> {overview.built}</li>
      <li><strong>担当範囲：</strong> {overview.role}</li>
      <li><strong>使用技術：</strong> {overview.tech}</li>
    </ul>
  </div>

  <div class="card">
    <h2>構成</h2>
    <ul>
      <li>電極（差動入力）→ 計装アンプ（ゲイン＋バイアス/基準電圧）</li>
      <li>計装アンプ出力 → アクティブ・バンドパス（DC除去＋ノイズ低減）</li>
      <li>整形後の出力 → 波形観測 / ADC入力</li>
    </ul>
  </div>

  <div class="card">
    <h2>検証</h2>
    <ul>
      {validation.map((v) => <li>{v}</li>)}
    </ul>

    <div class="muted" style="margin-top: 10px;">テスト信号の応答：</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.testSignal}`}
      alt="テスト信号の応答"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />

    <div class="muted" style="margin-top: 14px;">心拍の実測波形：</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.heartbeat}`}
      alt="心拍の実測波形"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />

    <div class="muted" style="margin-top: 14px;">測定時の様子（装着写真）：</div>
    <img
      src={`${import.meta.env.BASE_URL}${assets.onPerson}`}
      alt="装着して心拍を測定している様子"
      loading="lazy"
      style="width:100%; border-radius:12px; margin-top:10px;"
    />
  </div>

  <div class="card">
    <h2>工夫点</h2>
    <ul>
      {decisions.map((d) => <li>{d}</li>)}
    </ul>
  </div>

  <div class="card">
    <h2>結果</h2>
    <ul>
      {results.map((r) => <li>{r}</li>)}
    </ul>
  </div>

  <div class="card">
    <h2>今後の改善</h2>
    <ul>
      <li>実運用を想定し、安全性と堅牢性（入力保護・絶縁などの観点）をさらに強化する。</li>
      <li>QRSの鋭い成分を保ちながら、商用電源由来ノイズの抑圧を改善するようフィルタ設計を再最適化する。</li>
      <li>PCB化して配線由来ノイズを低減し、再現性を上げる。</li>
    </ul>
  </div>
</BaseLayout>
